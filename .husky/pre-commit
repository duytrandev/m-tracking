#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for formatting and linting of staged files
echo "\nğŸ“ Checking staged files (lint + format)..."
pnpm lint-staged || {
  echo "âŒ Lint-staged checks failed. Please fix the issues above."
  exit 1
}

# Type check affected projects (fast, only checks changed code)
echo "\nğŸ” Type checking affected projects..."
pnpm nx affected -t type-check --parallel=3 || {
  echo "âŒ Type check failed. Please fix TypeScript errors."
  exit 1
}

# Run tests on affected projects (optional - comment out if too slow)
# echo "\nğŸ§ª Testing affected projects..."
# pnpm nx affected -t test --parallel=3 || {
#   echo "âŒ Tests failed. Please fix failing tests."
#   exit 1
# }

echo "âœ… All pre-commit checks passed!\n"
